import os
import time
import itertools
import numpy as np
from astropy.io import ascii

def main():
    
    # Read IDs and distances
    data = ascii.read("/n/regal/iacs/rafael/all-distances.txt")
    id_list = data['recno']
    dist_list = data['D']
    errdist_list = data['eD']

    # Arrays with corresponding Av prior parameters
    log_Av = [0.53818976, 0.36628402, 0.46471918, 0.53892372, -0.05595549, 0.00221252, 0.53538724, 0.47113719, 0.6029762, 0.48409021, 0.68977866, 0.57204044, 0.56877423, 0.55151609, -0.30905526, -0.30905526, 0.38131952, 0.30874051, 0.34209017, 0.49650107, -0.00881446, 0.16005109, 0.0100789, 0.4261669, 0.57526643, 0.66453847, 0.08403961, 0.16273647, 0.19004671, 0.04111434, 0.69620168, 0.52136577, 0.63761695, 0.63761695, 0.45120815, 0.60335037, 0.54078922, 0.5993396, 0.45202481, 0.51513361, 0.59715015, 0.69320482, 0.7394838, 0.77176052, 0.64873102, 0.66815346, 0.68760577, 0.80661651, -0.15031284, 0.63504459, 0.67324984, 0.48348823, 0.69558043, 0.62962186, 0.59312095, 0.59312095, 0.69069478, 0.78976715, 0.76467568, 0.74870767, 0.85076986, 0.77041096, 0.71376339, 0.80348055, 0.64833513, 0.31331397, 0.35982674, 0.62951288, 0.45270138, -0.01994167]

    log_sigmas = [0.017669264334112089, 0.013003304297334678, 0.022734128971778123, 0.041768283515283416, 0.098284283059710792, 0.038887506555791124, 0.015796041001799876, 0.012736447332821504, 0.050647189723394048, 0.0068635680339173277, 0.050812960761097647, 0.0087811260650562106, 0.011279810957899816, 0.008726232870271633, 0.074813854881898581, 0.074813854881898581, 0.014318175695446383, 0.019573368418331238, 0.015983161427029713, 0.0090192613889136519, 0.056194520222583727, 0.067312963544722368, 0.073659524000985549, 0.023613864246482319, 0.011707796007559002, 0.011013736045661138, 0.016326165859404121, 0.016334152312197495, 0.017211131621022085, 0.043943399901898446, 0.01722159329036177, 0.009249076962533298, 0.01705429034124023, 0.01705429034124023, 0.015660867345134721, 0.010579967889021491, 0.046587603134960465, 0.03254704773410555, 0.013699483382083988, 0.012797375233053077, 0.014005744923402008, 0.0056707635915392296, 0.0057092997214243657, 0.0066106031307933133, 0.0092167763591965435, 0.012278196273112219, 0.0058095193560769864, 0.0077269661481861873, 0.24074664009970176, 0.016177708665241985, 0.0053075200223454133, 0.028319514565755793, 0.0089489936774648227, 0.021117251672043647, 0.02517301517576892, 0.02517301517576892, 0.0096713093137238415, 0.0082032660456994311, 0.0088709928048021358, 0.028045882206027439, 0.056237565093855968, 0.021171698289265906, 0.013172203629235879, 0.014330508772696926, 0.014289060234543793, 0.02083110975666691, 0.028524741647182272, 0.028968040068409695, 0.012140858723988374, 0.065885408414276564]


    for i in np.arange(len(id_list)):
        args = [id_list[i],dist_list[i],log_Av[i],log_sigmas[i]]
        arg_str = str(args[0]).strip('[]')+' '+str(args[1]).strip('[]')+' '+str(args[2]).strip('[]')+' '+str(args[3]).strip('[]')
        task = ('sbatch -p seas_iacs -c 2 -t 4-00:00 --mem=8000 --wrap="python GA_YSO_cluster_v2.py {}"').format(arg_str)

        print(task)
        os.system(task)
        #time.sleep(.5)

if __name__ == '__main__':
    main()
